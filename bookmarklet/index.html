<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriPlan Recipe Importer Bookmarklet</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
        }

        h1,
        h2 {
            color: #3c803c;
        }

        .bookmarklet {
            display: inline-block;
            padding: 10px 15px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-weight: bold;
            margin: 20px 0;
        }

        .instructions {
            background-color: #f9f9f9;
            border-left: 4px solid #4CAF50;
            padding: 15px;
            margin: 20px 0;
        }

        .note {
            background-color: #fff8e1;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }

        pre {
            background-color: #f5f5f5;
            padding: 15px;
            overflow-x: auto;
            border-radius: 4px;
        }

        img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            margin: 15px 0;
        }

        .step {
            margin-bottom: 20px;
        }

        .step-number {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            width: 25px;
            height: 25px;
            text-align: center;
            border-radius: 50%;
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>NutriPlan Recipe Importer Bookmarklet</h1>

    <p>This bookmarklet allows you to easily send the URL of any recipe page to your NutriPlan application for
        importing.</p>

    <div class="note">
        <strong>Note:</strong> Bookmarklets are small JavaScript programs that can be stored as a bookmark in your web
        browser. When clicked, they run on the current page.
    </div>

    <h2>Installation</h2>

    <div class="instructions">
        <div class="step">
            <span class="step-number">1</span>
            <strong>Drag this button to your bookmarks bar:</strong><br>
            <a href="javascript:(function()%7Bconst%20e%3D%60%3Cdiv%20id%3D%22nutriplan-config-modal%22%20style%3D%22position%3A%20fixed%3B%20top%3A%200%3B%20left%3A%200%3B%20width%3A%20100%25%3B%20height%3A%20100%25%3B%20background%3A%20rgba(0%2C0%2C0%2C0.7)%3B%20z-index%3A%20999999%3B%20display%3A%20flex%3B%20justify-content%3A%20center%3B%20align-items%3A%20center%3B%22%3E%3Cdiv%20style%3D%22background%3A%20white%3B%20padding%3A%2020px%3B%20border-radius%3A%205px%3B%20width%3A%20400px%3B%20max-width%3A%2090%25%3B%22%3E%3Ch2%20style%3D%22color%3A%20%233c803c%3B%20margin-top%3A%200%3B%22%3ENutriPlan%20Settings%3C%2Fh2%3E%3Cp%20style%3D%22margin-bottom%3A%2015px%3B%22%3EPlease%20enter%20your%20NutriPlan%20API%20token%20and%20application%20URL%3A%3C%2Fp%3E%3Cdiv%20style%3D%22margin-bottom%3A%2015px%3B%22%3E%3Clabel%20style%3D%22display%3A%20block%3B%20margin-bottom%3A%205px%3B%20font-weight%3A%20bold%3B%22%3EAPI%20Token%3A%3C%2Flabel%3E%3Cinput%20type%3D%22password%22%20id%3D%22nutriplan-api-token%22%20style%3D%22width%3A%20100%25%3B%20padding%3A%208px%3B%20border%3A%201px%20solid%20%23ccc%3B%20border-radius%3A%204px%3B%20box-sizing%3A%20border-box%3B%22%20placeholder%3D%22Enter%20your%20API%20token%22%3E%3C%2Fdiv%3E%3Cdiv%20style%3D%22margin-bottom%3A%2015px%3B%22%3E%3Clabel%20style%3D%22display%3A%20block%3B%20margin-bottom%3A%205px%3B%20font-weight%3A%20bold%3B%22%3EApplication%20URL%3A%3C%2Flabel%3E%3Cinput%20type%3D%22url%22%20id%3D%22nutriplan-app-url%22%20style%3D%22width%3A%20100%25%3B%20padding%3A%208px%3B%20border%3A%201px%20solid%20%23ccc%3B%20border-radius%3A%204px%3B%20box-sizing%3A%20border-box%3B%22%20placeholder%3D%22e.g.%2C%20https%3A%2F%2Fnutriplan.example.com%22%3E%3C%2Fdiv%3E%3Cdiv%20style%3D%22display%3A%20flex%3B%20justify-content%3A%20space-between%3B%22%3E%3Cbutton%20id%3D%22nutriplan-save-config%22%20style%3D%22background-color%3A%20%234CAF50%3B%20color%3A%20white%3B%20padding%3A%2010px%2015px%3B%20border%3A%20none%3B%20border-radius%3A%204px%3B%20cursor%3A%20pointer%3B%22%3ESave%20Settings%3C%2Fbutton%3E%3Cbutton%20id%3D%22nutriplan-cancel-config%22%20style%3D%22background-color%3A%20%23f44336%3B%20color%3A%20white%3B%20padding%3A%2010px%2015px%3B%20border%3A%20none%3B%20border-radius%3A%204px%3B%20cursor%3A%20pointer%3B%22%3ECancel%3C%2Fbutton%3E%3C%2Fdiv%3E%3Cdiv%20id%3D%22nutriplan-status%22%20style%3D%22margin-top%3A%2015px%3B%20padding%3A%2010px%3B%20border-radius%3A%204px%3B%20display%3A%20none%3B%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%60%2Ct%3D%60%3Cdiv%20id%3D%22nutriplan-notification-modal%22%20style%3D%22position%3A%20fixed%3B%20top%3A%2020px%3B%20right%3A%2020px%3B%20background%3A%20white%3B%20padding%3A%2015px%3B%20border-radius%3A%205px%3B%20box-shadow%3A%200%202px%2010px%20rgba(0%2C0%2C0%2C0.2)%3B%20z-index%3A%20999999%3B%20max-width%3A%20300px%3B%20display%3A%20none%3B%22%3E%3Cdiv%20id%3D%22nutriplan-notification-content%22%3E%3C%2Fdiv%3E%3C%2Fdiv%3E%60%3Bconst%20o%3D()%3D%3E%7Bconst%20e%3DlocalStorage.getItem(%22nutriplan-api-token%22)%2Ct%3DlocalStorage.getItem(%22nutriplan-app-url%22)%3Breturn%7BapiToken%3Ae%2CappUrl%3At%7D%7D%2Cn%3D(e%2Ct)%3D%3E%7BlocalStorage.setItem(%22nutriplan-api-token%22%2Ce)%2ClocalStorage.setItem(%22nutriplan-app-url%22%2Ct)%7D%3Blet%20a%3D(a%2Cl%3D!1)%3D%3E%7Blet%20i%3Ddocument.getElementById(%22nutriplan-notification-modal%22)%2Cr%3Ddocument.getElementById(%22nutriplan-notification-content%22)%3Bi%7C%7C(document.body.insertAdjacentHTML(%22beforeend%22%2Ct)%2Ci%3Ddocument.getElementById(%22nutriplan-notification-modal%22)%2Cr%3Ddocument.getElementById(%22nutriplan-notification-content%22))%2Cr.textContent%3Da%2Ci.style.backgroundColor%3Dl%3F%22%23f2dede%22%3A%22%23dff0d8%22%2Cr.style.color%3Dl%3F%22%23a94442%22%3A%22%233c763d%22%2Ci.style.display%3D%22block%22%2CsetTimeout(()%3D%3E%7Bi.style.display%3D%22none%22%7D%2C3e3)%7D%3Bconst%20l%3D()%3D%3E%7Bconst%20t%3Ddocument.getElementById(%22nutriplan-config-modal%22)%3Bt%26%26t.remove()%2Cdocument.body.insertAdjacentHTML(%22beforeend%22%2Ce)%3Bconst%7BapiToken%3Aa%2CappUrl%3Al%7D%3Do()%3Ba%26%26(document.getElementById(%22nutriplan-api-token%22).value%3Da)%2Cl%26%26(document.getElementById(%22nutriplan-app-url%22).value%3Dl)%2Cdocument.getElementById(%22nutriplan-save-config%22).addEventListener(%22click%22%2C()%3D%3E%7Bconst%20e%3Ddocument.getElementById(%22nutriplan-api-token%22).value.trim()%2Ct%3Ddocument.getElementById(%22nutriplan-app-url%22).value.trim()%3Bif(!e)%7Bconst%20e%3Ddocument.getElementById(%22nutriplan-status%22)%3Breturn%20e.textContent%3D%22Please%20enter%20your%20API%20token.%22%2Ce.style.backgroundColor%3D%22%23f2dede%22%2Ce.style.color%3D%22%23a94442%22%2Cvoid(e.style.display%3D%22block%22)%7Dif(!t)%7Bconst%20e%3Ddocument.getElementById(%22nutriplan-status%22)%3Breturn%20e.textContent%3D%22Please%20enter%20your%20NutriPlan%20application%20URL.%22%2Ce.style.backgroundColor%3D%22%23f2dede%22%2Ce.style.color%3D%22%23a94442%22%2Cvoid(e.style.display%3D%22block%22)%7Dtry%7Bnew%20URL(t)%7Dcatch(e)%7Bconst%20o%3Ddocument.getElementById(%22nutriplan-status%22)%3Breturn%20o.textContent%3D%22Please%20enter%20a%20valid%20URL%20including%20http%3A%2F%2F%20or%20https%3A%2F%2F.%22%2Co.style.backgroundColor%3D%22%23f2dede%22%2Co.style.color%3D%22%23a94442%22%2Cvoid(o.style.display%3D%22block%22)%7Dn(e%2Ct)%2Cdocument.getElementById(%22nutriplan-config-modal%22).remove()%2Ca(%22Settings%20saved%20successfully!%22)%7D)%2Cdocument.getElementById(%22nutriplan-cancel-config%22).addEventListener(%22click%22%2C()%3D%3E%7Bdocument.getElementById(%22nutriplan-config-modal%22).remove()%7D)%7D%3Bconst%20i%3D(e%2Ct%2Co)%3D%3E%7Bconst%20n%3D%60%24%7Bo.replace(%2F%5C%2F%24%2F%2C%22%22)%7D%2Fapi%2Frecipes%2Fimport-via-extension%60%3Ba(%22Sending%20recipe%20to%20NutriPlan...%22)%2Cfetch(n%2C%7Bmethod%3A%22POST%22%2Cheaders%3A%7B%22Content-Type%22%3A%22application%2Fjson%22%2CAccept%3A%22application%2Fjson%22%2CAuthorization%3A%60Bearer%20%24%7Bt%7D%60%7D%2Cbody%3AJSON.stringify(%7Burl%3Ae%7D)%7D).then(e%3D%3E%7Breturn%20e.ok%3Fvoid%20a(%22Recipe%20import%20started!%20Check%20your%20NutriPlan%20app%20shortly.%22)%3A401%3D%3D%3De.status%3Fvoid%20a(%22Authentication%20Error%3A%20Invalid%20API%20token.%20Please%20check%20your%20settings.%22%2C!0)%3A422%3D%3D%3De.status%3Fvoid%20a(%22Validation%20Error%3A%20The%20URL%20provided%20could%20not%20be%20processed.%22%2C!0)%3Ae.status%3E%3D500%3Fvoid%20a(%22Server%20Error%3A%20There%20was%20an%20error%20processing%20your%20request.%22%2C!0)%3Avoid%20a(%60Error%3A%20Unexpected%20error%20(%24%7Be.status%7D).%60%2C!0)%7D).catch(e%3D%3E%7Ba(%22Connection%20Error%3A%20Could%20not%20connect%20to%20NutriPlan.%22%2C!0)%2Cconsole.error(%22Error%20sending%20URL%20to%20API%3A%22%2Ce)%7D)%7D%3B(()%3D%3E%7Bconst%7BapiToken%3Ae%2CappUrl%3At%7D%3Do()%3Be%26%26t%3Fi(window.location.href%2Ce%2Ct)%3Al()%7D)()%7D)()"
                class="bookmarklet">Import to NutriPlan</a>
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Alternative method:</strong> If dragging doesn't work, you can:
            <ol>
                <li>Right-click on the button above and select "Bookmark This Link" or "Add to Bookmarks"</li>
                <li>OR create a new bookmark manually and copy-paste the code below into the URL/Address field</li>
            </ol>
        </div>
    </div>

    <h2>Usage</h2>

    <div class="instructions">
        <div class="step">
            <span class="step-number">1</span>
            <strong>First-time setup:</strong> The first time you click the bookmarklet, you'll be prompted to enter:
            <ul>
                <li>Your API Token (from your NutriPlan account)</li>
                <li>Your NutriPlan application URL (e.g., https://nutriplan.example.com)</li>
            </ul>
            These settings will be saved in your browser's localStorage.
        </div>

        <div class="step">
            <span class="step-number">2</span>
            <strong>Importing recipes:</strong>
            <ol>
                <li>Navigate to any recipe webpage</li>
                <li>Click the "Import to NutriPlan" bookmark in your bookmarks bar</li>
                <li>The recipe URL will be sent to your NutriPlan application for processing</li>
                <li>You'll see a notification when the import process has started</li>
            </ol>
        </div>
    </div>

    <h2>Troubleshooting</h2>

    <div class="instructions">
        <ul>
            <li><strong>To reset your settings:</strong> Right-click on the bookmarklet and select "Edit". Change the
                name if you'd like, but don't modify the code.</li>
            <li><strong>If you get authentication errors:</strong> You may need to update your API token. Click the
                bookmarklet on any page and cancel the import to access the settings.</li>
            <li><strong>If the bookmarklet doesn't work:</strong> Some websites with strict Content Security Policies
                might block bookmarklets. Try using the browser extension instead.</li>
        </ul>
    </div>

    <h2>Technical Details</h2>

    <p>The bookmarklet code is minified for efficiency. If you're curious about how it works, here's the original code:
    </p>

    <details>
        <summary>View bookmarklet source code</summary>
        <pre id="source-code"></pre>
    </details>

    <script>
        // Display the source code from the JavaScript file
        fetch('nutriplan-import.js')
            .then(response => response.text())
            .then(code => {
                document.getElementById('source-code').textContent = code;
            })
            .catch(error => {
                console.error('Error fetching source code:', error);
                document.getElementById('source-code').textContent = 'Error loading source code. Please check the JavaScript file.';
            });
    </script>
</body>

</html>